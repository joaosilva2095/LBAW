function enableTooltips(){$('[data-toggle="tooltip"]').tooltip({placement:"top"})}function removeUser(){var t=$(this).closest("tr").attr("id");t=t.replace("user",""),$.post("../api/delete_user.php",{id:t},function(e,i,r){$("#user"+t).remove()}).fail(function(e){$("#user"+t).highlightAnimation(red,1500)})}function registerUser(){var t=$("#identification").val(),e=$("#role").val(),i=$("#email").val(),r=$("#password").val(),a=$("#name").val(),l=$("#gender").val(),o=$("#birthdate").val(),n=$("#nif").val(),d=$("#cellphone").val(),s=$("#paymethod").val(),h=$("#periodicity").val();"Amigo"!==e&&(n=" ",d=" ",s=" ",h=" "),$.post("../api/register_user.php",{id:t,role:e,email:i,password:r,name:a,gender:l,birth:o,nif:n,cellphone:d,donative_type:s,periodicity:h},function(r,c,u){$("#userModal").modal("hide");var f=$("#users tr:last"),v=f.clone();v.attr("id","user"+t),v.removeClass("warning"),f.after(v),$("#user"+t+" td:nth-child(1)").html(t),$("#user"+t+" td:nth-child(2)").html(a),$("#user"+t+" td:nth-child(3)").html(i),$("#user"+t+" td:nth-child(4)").html(l),$("#user"+t+" td:nth-child(5)").html(o),$("#user"+t+" td:nth-child(6)").html(d),$("#user"+t+" td:nth-child(7)").html(n),$("#user"+t+" td:nth-child(8)").html(s),$("#user"+t+" td:nth-child(9)").html(h),$("#user"+t+" td:nth-child(10)").html(e),v.highlightAnimation(green,1500),$('i[data-original-title="Eliminar"]').click(removeUser),enableTooltips()}).fail(function(t){$("#userStatus").fadeIn()})}function togglePauseUser(){var t=$(this).closest("tr").attr("id");t=t.replace("user",""),$.post("../api/pause_user.php",{id:t},function(e,i,r){var a=$("#user"+t),l=$("#user"+t+"-frozen");a.hasClass("warning")?(a.removeClass("warning"),l.removeClass("fa-play"),l.addClass("fa-pause"),l.tooltip("hide").attr("data-original-title","Congelar").tooltip("fixTitle")):(a.addClass("warning"),l.removeClass("fa-pause"),l.addClass("fa-play"),l.tooltip("hide").attr("data-original-title","Descongelar").tooltip("fixTitle"))}).fail(function(e){$("#user"+t).highlightAnimation(red,1500)})}function updateUser(){var t=$("#identification").val(),e=$("#role").val(),i=$("#email").val(),a=($("#password").val(),$("#name").val()),l=$("#gender").val(),o=$("#birthdate").val(),n=$("#nif").val(),d=$("#cellphone").val(),s=$("#paymethod").val(),h=$("#periodicity").val();"Amigo"!=e&&(n=" ",d=" ",s=" ",h=" "),$.post("../api/edit_user.php",{id:t,role:e,email:i,name:a,gender:l,birth:o,nif:n,cellphone:d,donative_type:s,periodicity:h},function(r,c,u){$("#userModal").modal("hide"),$("#user"+t+" td:nth-child(1)").html(t),$("#user"+t+" td:nth-child(2)").html(a),$("#user"+t+" td:nth-child(3)").html(i),$("#user"+t+" td:nth-child(4)").html(l),$("#user"+t+" td:nth-child(5)").html(o),$("#user"+t+" td:nth-child(6)").html(d),$("#user"+t+" td:nth-child(7)").html(n),$("#user"+t+" td:nth-child(8)").html(s),$("#user"+t+" td:nth-child(9)").html(h),$("#user"+t+" td:nth-child(10)").html(e),$("#user"+t).highlightAnimation(green,1500)}).fail(function(t){$("#userStatus").fadeIn()})}function addUserNotification(){var t=$("#notificationUserId").val(),e=$("#notificationMessage").val(),i=$("#notificationType").val();$.post("../api/add_notification.php",{id:t,message:e,type:i},function(e,i,r){$("#notificationModal").modal("hide"),$("#user"+t).highlightAnimation(green,1500)}).fail(function(t){$("#notificationStatus").fadeIn()})}function configEditUserModal(){$("#userModal form").trigger("reset"),$("#userModalTitle").html("Editar Utilizador");var t=$(this).closest("tr").attr("id");t=t.replace("user","");var e=$("#user"+t+" td:nth-child(2)").text(),i=$("#user"+t+" td:nth-child(3)").text(),r=$("#user"+t+" td:nth-child(4)").text(),a=$("#user"+t+" td:nth-child(5)").text(),l=$("#user"+t+" td:nth-child(6)").text(),o=$("#user"+t+" td:nth-child(7)").text(),n=$("#user"+t+" td:nth-child(8)").text(),d=$("#user"+t+" td:nth-child(9)").text(),s=$("#user"+t+" td:nth-child(10)").text();$('label[for="password"]').hide(),$("#password").removeAttr("required"),$("#password").hide(),"Amigo"==s?$("#friendOnlyParams").show():$("#friendOnlyParams").hide(),$("#identification").attr("disabled","disabled"),$("#identification").val(t),$("#name").val(e),$("#email").val(i),$("#gender").val(r),$("#birthdate").val(a),$("#role").val(s),$("#nif").val(o),$("#cellphone").val(l),$("#paymethod").val(n),$("#periodicity").val(d)}function configNewUserModal(){$("#userModal form").trigger("reset"),$("#friendOnlyParams").fadeIn(),$('label[for="password"]').show(),$("#password").attr("required","required"),$("#password").show(),$("#identification").removeAttr("disabled"),$("#userModalTitle").html("Novo Utilizador")}function configAddNotificationModal(){var t=$(this).closest("tr").attr("id");t=t.replace("user",""),$("#notificationUserId").val(t)}var green="#DFF0D8",red="#A94442";$.fn.highlightAnimation=function(t,e){var i=t||"#DFF0D8",r=e||1500;this.css("background-color","");var a=this.css("background-color");this.stop().css("background-color",i).animate({backgroundColor:a},r)},$(document).ready(function(){enableTooltips(),$("#newUser").click(configNewUserModal),$("#userForm").submit(function(t){t.preventDefault(),"Novo Utilizador"==$("#userModalTitle").text()?registerUser():updateUser()}),$("#userStatus").click(function(){$(this).fadeOut()}),$("#role").change(function(){var t=$("#role").val();"Amigo"===t?($("#nif").attr("required","required"),$("#cellphone").attr("required","required"),$("#paymethod").attr("required","required"),$("#periodicity").attr("required","required"),$("#friendOnlyParams").fadeIn()):($("#nif").removeAttr("required"),$("#cellphone").removeAttr("required"),$("#paymethod").removeAttr("required"),$("#periodicity").removeAttr("required"),$("#friendOnlyParams").fadeOut())}),$("#notificationForm").submit(function(t){t.preventDefault(),addUserNotification()}),$("#notificationStatus").click(function(){$(this).fadeOut()}),$('i[data-original-title="Editar"]').click(configEditUserModal),$('i[data-original-title="Eliminar"]').click(removeUser),$('i[data-original-title="Congelar"]').click(togglePauseUser),$('i[data-original-title="Descongelar"]').click(togglePauseUser),$('i[data-original-title="Notificar"]').click(configAddNotificationModal)});
