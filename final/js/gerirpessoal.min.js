var green="#DFF0D8";var red="#A94442";function updateUser(){var id=$("#identification").val(),role=$("#role").val(),email=$("#email").val(),password=$("#password").val(),name=$("#name").val(),gender=$("#gender").val(),birth=$("#birthdate").val(),nif=$("#nif").val(),cellphone=$("#cellphone").val(),donativeType=$("#paymethod").val(),periodicity=$("#periodicity").val();$.post("../api/register_user.php",{id:id,role:role,email:email,password:password,name:name,gender:gender,birth:birth,nif:nif,cellphone:cellphone,donative_type:donativeType,periodicity:periodicity},function(data,statusText,xhr){$("#userModal").modal("hide");var tr=$("#users tr:last"),trNew=tr.clone();trNew.attr("id","user"+id);tr.after(trNew);$("#user"+id+" td:nth-child(1)").html(id);$("#user"+id+" td:nth-child(2)").html(name);$("#user"+id+" td:nth-child(3)").html(birth);$("#user"+id+" td:nth-child(4)").html(role);trNew.highlightAnimation(green,1500);$('i[data-original-title="Eliminar"]').click(removeUser);enableTooltips();}).fail(function(error){$("#userStatus").fadeIn();});}function removeUser(){var id=$(this).closest("tr").attr("id");id=id.replace("user","");$.post("../api/delete_user.php",{id:id},function(data,statusText,xhr){$("#user"+id).remove();}).fail(function(error){$("#user"+id).highlightAnimation(red,1500);});}function togglePauseUser(){var id=$(this).closest("tr").attr("id");id=id.replace("user","");$.post("../api/pause_user.php",{id:id},function(data,statusText,xhr){var userRow=$("#user"+id),userFrozenIcon=$("#user"+id+"-frozen");if(userRow.hasClass("warning")){userRow.removeClass("warning");userFrozenIcon.removeClass("fa-play");userFrozenIcon.addClass("fa-pause");userFrozenIcon.tooltip("hide").attr("data-original-title","Congelar").tooltip("fixTitle");}else{userRow.addClass("warning");userFrozenIcon.removeClass("fa-pause");userFrozenIcon.addClass("fa-play");userFrozenIcon.tooltip("hide").attr("data-original-title","Descongelar").tooltip("fixTitle");}}).fail(function(error){$("#user"+id).highlightAnimation(red,1500);});}function enableTooltips(){$('[data-toggle="tooltip"]').tooltip({placement:"top"});}$.fn.highlightAnimation=function(highlightColor,duration){var highlightBg=highlightColor||"#DFF0D8",animateMs=duration||1500,originalBg=this.css("background-color");this.stop().css("background-color",highlightBg).animate({backgroundColor:originalBg},animateMs);};$(document).ready(function(){enableTooltips();$("#newUser").click(function(){$("#userModal form").trigger("reset");$("#friendOnlyParams").fadeIn();$("#userModalTitle").html("Novo Utilizador");});$("#userSubmit").click(updateUser);$('i[data-original-title="Editar"]').click(function(){$("#userModal form").trigger("reset");$("#userModalTitle").html("Editar Utilizador");var id=$(this).closest("tr").attr("id");id=id.replace("user","");var name=$("#user"+id+" td:nth-child(2)").text(),email=$("#user"+id+" td:nth-child(3)").text(),gender=$("#user"+id+" td:nth-child(4)").text(),birth=$("#user"+id+" td:nth-child(5)").text(),cellphone=$("#user"+id+" td:nth-child(6)").text(),nif=$("#user"+id+" td:nth-child(7)").text(),donativeType=$("#user"+id+" td:nth-child(8)").text(),periodicity=$("#user"+id+" td:nth-child(9)").text(),role=$("#user"+id+" td:nth-child(10)").text();if(role=="Amigo"){$("#friendOnlyParams").fadeIn();}else{$("#friendOnlyParams").fadeOut();}$("#identification").val(id);$("#name").val(name);$("#email").val(email);$("#gender").val(gender);$("#birthdate").val(birthdate);$("#role").val(role);$("#nif").val(nif);$("#cellphone").val(cellphone);$("#paymethod").val(donativeType);$("#periodicity").val(periodicity);});$('i[data-original-title="Eliminar"]').click(removeUser);$('i[data-original-title="Congelar"]').click(togglePauseUser);$('i[data-original-title="Descongelar"]').click(togglePauseUser);$("#userStatus").click(function(){$(this).fadeOut();});$("#role").change(function(){var role=$("#role").val();if(role==="Amigo"){$("#friendOnlyParams").fadeIn();}else{$("#friendOnlyParams").fadeOut();}});});